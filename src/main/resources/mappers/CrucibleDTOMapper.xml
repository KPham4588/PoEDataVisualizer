<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.5.10//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.PhamKornbluhGroup.mybatismysqlimpl.ICrucibleDTO">

    <resultMap id="CrucibleDTOMap" type="com.PhamKornbluhGroup.DTO.CrucibleDTO" autoMapping="false">
        <id property="dbId" column="dbId"/>
        <result property="itemId" column="itemId"/>
        <result property="layout" column="layout"/>
<!--        <association property="node" resultMap="com.PhamKornbluhGroup.mybatismysqlimpl.ICrucibleNodeDTO.CrucibleNodeDTOMap" autoMapping="true"/>-->


        <!-- If this is confused by the getentitybyID then we might need to put in the mapper namespace before the query-->
        <collection property="nodes" javaType="ArrayList" column="id" ofType="com.PhamKornbluhGroup.DTO.CrucibleNodeDTO" select="getEntityById"/>

    </resultMap>

    <select id="getEntityById" resultMap="CrucibleDTOMap">
        <![CDATA[
        SELECT
            Crucible.dbid,
            Crucible.itemId,
            Crucible.layout,
            -- All of the CrucibleNode fields below link to the associated Arraylist "nodes" property, mapped via the CrucibleNodeDTOMapper Resultmap
            CrucibleNode.dbid AS nodeDbId,
            CrucibleNode.crucibleId,
            CrucibleNode.skill,
            CrucibleNode.tier,
            CrucibleNode.icon,
            CrucibleNode.allocated,
            CrucibleNode.isNotable,
            CrucibleNode.isReward,
            CrucibleNode.stats,
            CrucibleNode.reminderText,
            CrucibleNode.orbit,
            CrucibleNode.orbitIndex,
            CrucibleNode.`out`,
            CrucibleNode.`in`,
            CrucibleNode.`crucibleNodeIndex`
        FROM `poe-oracle`.Crucible AS Crucible
        INNER JOIN `poe-oracle`.CrucibleNode AS CrucibleNode
        ON Crucible.dbId = CrucibleNode.crucibleId
        WHERE Crucible.dbId = #{dbId}
		]]>
    </select>

    <insert id="saveEntity" useGeneratedKeys="true" keyProperty="dbId">
        <![CDATA[
			INSERT INTO `poe-oracle`.Crucible
			(itemId, layout)
			VALUES (#{itemId}, #{layout})
		]]>
    </insert>

    <update id="updateEntity">
        <![CDATA[
			UPDATE `poe-oracle`.Crucible
			SET itemId = #{itemId},
			layout = #{layout}
			WHERE dbId = #{dbId}
		]]>
    </update>

    <delete id="removeEntity">
        <![CDATA[
			DELETE FROM `poe-oracle`.Crucible
			WHERE dbId = #{dbId}
		]]>
    </delete>

</mapper>