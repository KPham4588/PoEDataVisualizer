<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.5.10//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.PhamKornbluhGroup.mybatismysqlimpl.ICrucibleNodeDTO">

    <resultMap id="CrucibleNodeDTOMap" type="com.PhamKornbluhGroup.DTO.CrucibleNodeDTO" autoMapping="false">
        <id property="dbId" column="dbId"/>
        <result property="crucibleId" column="crucibleId"/>
        <result property="skill" column="skill"/>
        <result property="tier" column="tier"/>
        <result property="icon" column="icon"/>
        <result property="allocated" column="allocated"/>
        <result property="isNotable" column="isNotable"/>
        <result property="isReward" column="isReward"/>
        <result property="reminderText" column="reminderText"/>
        <result property="orbit" column="orbit"/>
        <result property="orbitIndex" column="orbitIndex"/>
        <result property="crucibleNodeIndex" column="crucibleNodeIndex"/>
        <collection property="stats" column="dbId" javaType="ArrayList" ofType="java.lang.String"
                    select="getStatsByCrucibleNodeId">
            <result property="stat" column="stat"/>
        </collection>
        <collection property="out" column="dbId" javaType="ArrayList" ofType="java.lang.String"
                    select="getOutByCrucibleNodeId">
            <result property="outVal" column="outVal"/>
        </collection>
        <collection property="in" column="dbId" javaType="ArrayList" ofType="java.lang.String"
                    select="getInByCrucibleNodeId">
            <result property="inVal" column="inVal"/>
        </collection>
    </resultMap>

    <!-- TESTED -->
    <select id="getEntityById" resultMap="CrucibleNodeDTOMap">
        <![CDATA[
            SELECT *
            FROM CrucibleNode
            WHERE dbId = #{dbId}
        ]]>
    </select>

    <!-- TESTED -->
    <select id="getEntityByCrucibleId" resultMap="CrucibleNodeDTOMap">
        <![CDATA[
            SELECT *
            FROM CrucibleNode
            WHERE crucibleId = #{dbId}
        ]]>
    </select>

    <select id="getStatsByCrucibleNodeId" resultType="java.lang.String">
        <![CDATA[
        SELECT CrucibleNodeStats.stat
        FROM CrucibleNodeStats
        WHERE CrucibleNodeStats.dbid = #{dbId}
		]]>
    </select>

    <select id="getOutByCrucibleNodeId" resultType="java.lang.String">
        <![CDATA[
        SELECT CrucibleNodeOut.out
        FROM CrucibleNodeOut
        WHERE CrucibleNodeOut.dbid = #{dbId}
		]]>
    </select>

    <select id="getInByCrucibleNodeId" resultType="java.lang.String">
        <![CDATA[
        SELECT CrucibleNodeIn.in
        FROM CrucibleNodeIn
        WHERE CrucibleNodeIn.dbid = #{dbId}
		]]>
    </select>

    <!-- TESTED -->
    <insert id="saveEntity" useGeneratedKeys="true" keyProperty="dbId">
        <![CDATA[
            INSERT INTO CrucibleNode
                (crucibleId, skill, tier, icon, allocated, isNotable, isReward,
                stats, reminderText, orbit, orbitIndex, `out`, `in`, crucibleNodeIndex)
            VALUES (#{crucibleId}, #{skill}, #{tier}, #{icon}, #{allocated},
                #{isNotable}, #{isReward}, #{stats}, #{reminderText},
                #{orbit}, #{orbitIndex}, #{out}, #{in}, #{crucibleNodeIndex})
        ]]>
    </insert>

    <!-- TESTED -->
    <delete id="removeEntity">
        <![CDATA[
            DELETE FROM CrucibleNode
            WHERE dbId = #{dbId}
        ]]>
    </delete>

    <!-- TESTED -->
    <update id="updateEntity">
        <![CDATA[
            UPDATE CrucibleNode
            SET crucibleId = #{crucibleId},
                skill = #{skill},
                tier = #{tier},
                icon = #{icon},
                allocated = #{allocated},
                isNotable = #{isNotable},
                isReward = #{isReward},
                stats = #{stats},
                reminderText = #{reminderText},
                orbit = #{orbit},
                orbitIndex = #{orbitIndex},
                `out` = #{out},
                `in` = #{in},
                crucibleNodeIndex = #{crucibleNodeIndex}
            WHERE dbId = #{dbId}
        ]]>
    </update>

</mapper>