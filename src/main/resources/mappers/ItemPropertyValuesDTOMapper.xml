<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.5.10//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "com.PhamKornbluhGroup.mybatismysqlimpl.IItemPropertyValuesDTO">
        <!--
        Hybrid ==> Calls Select of ItemProperty
        ItemProperty ==> Calls Select of ItemPropertyValues

        Assume we select HybridDTO with dbid of 5
        Assume ItemPropertyDTO has personal DbId of 25, but has HybridId = 5 (Correctly linked to the parent)
        Assume ItemPropertyValuesDTO has personal DbId of 50, but has ItemPropertyId of 25 (Correctly linked to the parent)

        We need to make sure that when calling from Hybrid, down to ItemProperty, down to ItemPropertyValues
        that the correct DbId is being passed each time
        -->
    <resultMap id="ItemPropertyValuesDTOMap" type="com.PhamKornbluhGroup.DTO.ItemPropertyValuesDTO" autoMapping = "false">
        <id property = "dbId" column = "dbId"/>
        <result property = "itemPropertyId" column = "itemPropertyId"/>
        <result property = "value" column = "value"/>
        <result property = "valueType" column = "valueType"/>
    </resultMap>

    <!-- UNTESTED -->
    <select id = "getEntityById"> resultMap = "IItemPropertyValuesDTO"
        <![CDATA[
			SELECT *
			FROM ItemPropertyValues
			WHERE dbId = #{dbId}
		]]>
    </select>

    <!-- Untested as called by parent ItemPropertyDTOMapper -->
    <select id = "getEntityByItemPropertyId"> resultMap = "IItemPropertyValuesDTO"
        <![CDATA[
			SELECT *
			FROM ItemPropertyValues
			WHERE itemPropertyId = #{dbId}
		]]>
    </select>

    <!-- UNTESTED -->
    <insert id = "saveEntity" useGeneratedKeys = "true" keyProperty = "dbId">
        <![CDATA[
			INSERT INTO ItemPropertyValues
			    (itemPropertyId, value, valueType)
			VALUES (#{itemPropertyId}, #{value}, #{valueType})
		]]>
    </insert>

    <!-- UNTESTED -->
    <delete id = "removeEntity">
        <![CDATA[
			DELETE FROM ItemPropertyValues
			WHERE dbId = #{dbId}
		]]>
    </delete>

    <!-- UNTESTED -->
    <update id = "updateEntity">
        <![CDATA[
			UPDATE ItemPropertyValues
			SET itemPropertyId = #{itemPropertyId},
			    value = #{value},
			    valueType = #{valueType},
			WHERE dbId = #{dbId},
		]]>
    </update>

</mapper>